<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Family Dashboard üè†</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            --bg-primary: #FFF5E1;
            --bg-secondary: #FFEFD5;
            --text-primary: #2C3E50;
            --text-secondary: #5D6D7E;
            --accent-misha: #FF6B9D;
            --accent-kamia: #9B59D0;
            --success: #4CAF50;
            --warning: #FFA726;
            --card-bg: #FFFFFF;
            --shadow: rgba(0, 0, 0, 0.1);
            --overlay: rgba(0, 0, 0, 0.5);
            --timer-green: #4CAF50;
            --timer-yellow: #FFC107;
            --timer-red: #FF5252;
        }

        [data-theme="dark"] {
            --bg-primary: #1A1A2E;
            --bg-secondary: #16213E;
            --text-primary: #EAEAEA;
            --text-secondary: #B8B8B8;
            --card-bg: #0F3460;
            --shadow: rgba(0, 0, 0, 0.3);
            --overlay: rgba(0, 0, 0, 0.7);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }

        .header {
            text-align: center;
            padding: 20px 0;
            position: relative;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #FF6B9D, #9B59D0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .theme-toggle {
            position: absolute;
            top: 20px;
            right: 0;
            background: var(--card-bg);
            border: none;
            border-radius: 50px;
            padding: 10px 20px;
            font-size: 1.2em;
            cursor: pointer;
            box-shadow: 0 4px 15px var(--shadow);
            transition: transform 0.2s;
        }

        .theme-toggle:active {
            transform: scale(0.95);
        }

        .profile-select {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 40px;
        }

        .profile-btn {
            background: var(--card-bg);
            border: none;
            border-radius: 30px;
            padding: 40px 20px;
            cursor: pointer;
            box-shadow: 0 8px 25px var(--shadow);
            transition: transform 0.3s, box-shadow 0.3s;
            position: relative;
            overflow: hidden;
        }

        .profile-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 35px var(--shadow);
        }

        .profile-btn:active {
            transform: translateY(-2px);
        }

        .profile-btn.misha {
            background: linear-gradient(135deg, #FFE5EC, #FFB3C6);
        }

        .profile-btn.kamia {
            background: linear-gradient(135deg, #E5D4F5, #C5A3E8);
        }

        .profile-btn.parent {
            background: linear-gradient(135deg, #FFE5B4, #FFD700);
            grid-column: 1 / -1;
        }

        .profile-avatar {
            font-size: 4em;
            margin-bottom: 15px;
            display: block;
        }

        .profile-name {
            font-size: 1.8em;
            font-weight: bold;
            color: var(--text-primary);
        }

        .profile-stats {
            margin-top: 10px;
            font-size: 1.2em;
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        /* EXPLORER MODE */
        .explorer-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 25px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 8px 30px var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .explorer-section::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: explorer-glow 4s ease-in-out infinite;
        }

        @keyframes explorer-glow {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            50% { transform: translate(-20px, -20px) rotate(180deg); }
        }

        .explorer-header {
            text-align: center;
            color: white;
            margin-bottom: 20px;
            position: relative;
            z-index: 1;
        }

        .explorer-title {
            font-size: 1.8em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .explorer-subtitle {
            font-size: 1em;
            opacity: 0.9;
        }

        .discovery-card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            z-index: 1;
            min-height: 150px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .discovery-card:active {
            transform: scale(0.98);
        }

        .discovery-card.locked {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            animation: treasure-pulse 2s ease-in-out infinite;
        }

        @keyframes treasure-pulse {
            0%, 100% { transform: scale(1); box-shadow: 0 8px 30px rgba(255, 215, 0, 0.3); }
            50% { transform: scale(1.02); box-shadow: 0 12px 40px rgba(255, 215, 0, 0.5); }
        }

        .discovery-locked-content {
            text-align: center;
        }

        .discovery-treasure {
            font-size: 4em;
            margin-bottom: 15px;
            animation: treasure-bounce 1s ease-in-out infinite;
        }

        @keyframes treasure-bounce {
            0%, 100% { transform: translateY(0) rotate(-5deg); }
            50% { transform: translateY(-10px) rotate(5deg); }
        }

        .discovery-locked-text {
            font-size: 1.3em;
            font-weight: bold;
            color: var(--text-primary);
        }

        .discovery-unlocked-content {
            text-align: center;
            animation: reveal-fade 0.5s ease;
        }

        @keyframes reveal-fade {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        .discovery-emoji {
            font-size: 4em;
            margin-bottom: 15px;
        }

        .discovery-topic {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 15px;
            color: var(--text-primary);
        }

        .discovery-fact {
            font-size: 1.1em;
            line-height: 1.6;
            color: var(--text-secondary);
            margin-bottom: 15px;
        }

        .discovery-reward {
            font-size: 1.2em;
            font-weight: bold;
            color: var(--success);
            padding: 10px 20px;
            background: #E8F5E9;
            border-radius: 15px;
            display: inline-block;
        }

        .discovery-completed {
            opacity: 0.7;
            cursor: default;
        }

        .kid-view {
            display: none;
        }

        .kid-view.active {
            display: block;
        }

        .kid-header {
            background: var(--card-bg);
            border-radius: 25px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px var(--shadow);
        }

        .kid-header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .kid-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .kid-avatar {
            font-size: 3em;
        }

        .kid-name-group {
            display: flex;
            flex-direction: column;
        }

        .kid-name {
            font-size: 1.8em;
            font-weight: bold;
        }

        .kid-level {
            font-size: 1em;
            color: var(--warning);
            font-weight: bold;
        }

        .kid-stats {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 5px;
        }

        .stat-item {
            font-size: 1.3em;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .xp-bar-container {
            width: 100%;
            height: 25px;
            background: var(--bg-secondary);
            border-radius: 15px;
            overflow: hidden;
            position: relative;
            margin-bottom: 10px;
        }

        .xp-bar {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            transition: width 0.5s ease;
            border-radius: 15px;
        }

        .xp-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-weight: bold;
            font-size: 0.9em;
            color: var(--text-primary);
            text-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }

        .achievements-mini {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .achievement-badge {
            font-size: 1.5em;
            opacity: 0.3;
            filter: grayscale(100%);
            transition: all 0.3s;
        }

        .achievement-badge.unlocked {
            opacity: 1;
            filter: grayscale(0%);
            animation: badge-pop 0.5s ease;
        }

        @keyframes badge-pop {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.3); }
        }

        /* TIMER BLOCK */
        .timer-block {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 30px;
            padding: 30px;
            margin-bottom: 20px;
            text-align: center;
            color: white;
            box-shadow: 0 8px 30px var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .timer-block::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: timer-glow 3s ease-in-out infinite;
        }

        @keyframes timer-glow {
            0%, 100% { transform: translate(0, 0) scale(1); }
            50% { transform: translate(10px, 10px) scale(1.05); }
        }

        .timer-activity {
            font-size: 2.5em;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }

        .timer-countdown {
            font-size: 5em;
            font-weight: bold;
            font-family: 'Courier New', monospace;
            margin: 20px 0;
            position: relative;
            z-index: 1;
            text-shadow: 0 4px 10px rgba(0,0,0,0.3);
            transition: color 0.5s;
        }

        .timer-countdown.green { color: #4CAF50; }
        .timer-countdown.yellow { color: #FFC107; }
        .timer-countdown.red { 
            color: #FF5252;
            animation: pulse-timer 1s infinite;
        }

        @keyframes pulse-timer {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .timer-label {
            font-size: 1.2em;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .next-activity {
            margin-top: 20px;
            padding: 15px;
            background: rgba(255,255,255,0.2);
            border-radius: 15px;
            font-size: 1.1em;
            position: relative;
            z-index: 1;
        }

        .no-timer {
            background: var(--card-bg);
            border-radius: 25px;
            padding: 30px;
            margin-bottom: 20px;
            text-align: center;
            color: var(--text-secondary);
            box-shadow: 0 4px 20px var(--shadow);
        }

        .quick-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
        }

        .quick-btn {
            background: var(--card-bg);
            border: none;
            border-radius: 20px;
            padding: 12px 20px;
            font-size: 1.1em;
            cursor: pointer;
            box-shadow: 0 4px 15px var(--shadow);
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .quick-btn:active {
            transform: scale(0.95);
        }

        .back-btn {
            background: var(--card-bg);
            border: 3px solid var(--accent-misha);
            border-radius: 50%;
            width: 70px;
            height: 70px;
            font-size: 2.2em;
            cursor: pointer;
            box-shadow: 0 6px 20px var(--shadow);
            position: fixed;
            bottom: 24px;
            left: 24px;
            z-index: 100;
            transition: transform 0.2s;
        }

        .back-btn:active {
            transform: scale(0.9);
        }

        .tasks-grid {
            display: grid;
            gap: 15px;
            margin-bottom: 80px;
        }

        .tasks-grid.misha {
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .task-card {
            background: var(--card-bg);
            border-radius: 25px;
            padding: 25px;
            cursor: pointer;
            box-shadow: 0 4px 20px var(--shadow);
            transition: all 0.3s;
            position: relative;
            min-height: 80px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }

        .task-card.misha {
            min-height: 150px;
            padding: 30px 15px;
        }

        .task-card:active {
            transform: scale(0.95);
        }

        .task-card.completed {
            opacity: 0.6;
            background: linear-gradient(135deg, #D4EDDA, #C3E6CB);
        }

        .task-emoji {
            font-size: 3em;
            display: block;
            margin-bottom: 10px;
        }

        .task-card.misha .task-emoji {
            font-size: 4em;
            margin-bottom: 15px;
        }

        .task-title {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .task-card.misha .task-title {
            font-size: 1.1em;
            line-height: 1.3;
        }

        .task-xp {
            font-size: 0.9em;
            color: var(--success);
            font-weight: bold;
            margin-top: 5px;
        }

        .task-subtasks {
            margin-top: 10px;
            font-size: 0.9em;
            color: var(--text-secondary);
        }

        .subtask {
            padding: 5px 0;
            text-align: left;
        }

        .subtask.done {
            text-decoration: line-through;
            opacity: 0.6;
        }

        .checkmark {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 2em;
            display: none;
        }

        .task-card.completed .checkmark {
            display: block;
        }

        /* REWARD SHOP */
        .shop-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--overlay);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
        }

        .shop-content {
            background: var(--card-bg);
            border-radius: 30px;
            padding: 30px;
            max-width: 500px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }

        .shop-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .shop-header h2 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .shop-balance {
            font-size: 1.5em;
            color: var(--warning);
            font-weight: bold;
        }

        .shop-items {
            display: grid;
            gap: 15px;
        }

        .shop-item {
            background: var(--bg-secondary);
            border-radius: 20px;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: transform 0.2s;
        }

        .shop-item:active {
            transform: scale(0.98);
        }

        .shop-item-info {
            flex: 1;
        }

        .shop-item-name {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .shop-item-cost {
            font-size: 1.1em;
            color: var(--warning);
            font-weight: bold;
        }

        .shop-item-btn {
            background: linear-gradient(135deg, #FF6B9D, #9B59D0);
            color: white;
            border: none;
            border-radius: 15px;
            padding: 12px 24px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
        }

        .shop-item-btn:disabled {
            background: var(--text-secondary);
            opacity: 0.5;
            cursor: not-allowed;
        }

        .shop-item-btn:active:not(:disabled) {
            transform: scale(0.95);
        }

        .shop-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            font-size: 2em;
            cursor: pointer;
            color: var(--text-primary);
        }

        /* Parent View */
        .parent-view {
            display: none;
        }

        .parent-view.active {
            display: block;
        }

        .pin-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--overlay);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .pin-dialog {
            background: var(--card-bg);
            border-radius: 30px;
            padding: 40px;
            text-align: center;
            max-width: 90%;
            box-shadow: 0 10px 40px var(--shadow);
        }

        .pin-input {
            font-size: 2em;
            text-align: center;
            border: 3px solid var(--accent-misha);
            border-radius: 15px;
            padding: 15px;
            margin: 20px 0;
            width: 200px;
            letter-spacing: 15px;
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        .pin-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 20px;
        }

        .pin-btn {
            background: var(--card-bg);
            border: 2px solid var(--text-secondary);
            border-radius: 15px;
            padding: 20px;
            font-size: 1.5em;
            cursor: pointer;
            transition: all 0.2s;
        }

        .pin-btn:active {
            transform: scale(0.95);
            background: var(--accent-misha);
            color: white;
        }

        .admin-section {
            background: var(--card-bg);
            border-radius: 25px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px var(--shadow);
        }

        .admin-section h2 {
            margin-bottom: 20px;
            color: var(--accent-misha);
        }

        .kid-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .kid-selector button {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 15px;
            font-size: 1.1em;
            cursor: pointer;
            background: var(--bg-secondary);
            transition: all 0.2s;
        }

        .kid-selector button.active {
            background: linear-gradient(135deg, #FF6B9D, #9B59D0);
            color: white;
            transform: scale(1.05);
        }

        .task-form, .timer-form, .reward-form {
            display: grid;
            gap: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            margin-bottom: 5px;
            font-weight: bold;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            padding: 12px;
            border: 2px solid var(--text-secondary);
            border-radius: 12px;
            font-size: 1em;
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 15px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }

        .btn-primary {
            background: linear-gradient(135deg, #FF6B9D, #9B59D0);
            color: white;
        }

        .btn-primary:active {
            transform: scale(0.95);
        }

        .task-list, .timer-list, .reward-list {
            display: grid;
            gap: 10px;
        }

        .task-item, .timer-item, .reward-item {
            background: var(--bg-secondary);
            padding: 15px;
            border-radius: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .task-item-emoji, .timer-item-emoji, .reward-item-emoji {
            font-size: 2em;
            margin-right: 10px;
        }

        .task-item-info, .timer-item-info, .reward-item-info {
            flex: 1;
        }

        .task-item-actions, .timer-item-actions, .reward-item-actions {
            display: flex;
            gap: 10px;
        }

        .btn-small {
            padding: 8px 15px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.9em;
        }

        .btn-edit {
            background: #FFA726;
            color: white;
        }

        .btn-delete {
            background: #EF5350;
            color: white;
        }

        .history-item {
            padding: 10px;
            border-bottom: 1px solid var(--text-secondary);
            display: flex;
            justify-content: space-between;
        }

        .purchase-history {
            max-height: 300px;
            overflow-y: auto;
        }

        .tab-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            background: var(--bg-secondary);
            font-size: 1em;
            transition: all 0.2s;
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #FF6B9D, #9B59D0);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Confetti Animation */
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            top: -10px;
            z-index: 9999;
            pointer-events: none;
            animation: confetti-fall 3s linear forwards;
        }

        @keyframes confetti-fall {
            to {
                transform: translateY(110vh) rotate(720deg);
                opacity: 0;
            }
        }

        .completion-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: var(--card-bg);
            border-radius: 30px;
            padding: 40px;
            text-align: center;
            z-index: 9998;
            box-shadow: 0 10px 50px var(--shadow);
            animation: popup 0.5s ease forwards;
        }

        @keyframes popup {
            0% { transform: translate(-50%, -50%) scale(0); }
            50% { transform: translate(-50%, -50%) scale(1.1); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }

        .popup-emoji {
            font-size: 5em;
            margin-bottom: 20px;
            animation: bounce 0.5s ease infinite alternate;
        }

        @keyframes bounce {
            from { transform: translateY(0); }
            to { transform: translateY(-20px); }
        }

        .popup-text {
            font-size: 1.5em;
            font-weight: bold;
        }

        .popup-subtext {
            font-size: 1.2em;
            color: var(--text-secondary);
            margin-top: 10px;
        }

        /* Level Up Animation */
        .levelup-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: white;
            border-radius: 30px;
            padding: 50px;
            text-align: center;
            z-index: 9999;
            box-shadow: 0 10px 50px rgba(255, 215, 0, 0.5);
            animation: popup 0.6s ease forwards;
        }

        .levelup-text {
            font-size: 3em;
            font-weight: bold;
            text-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        /* Responsive */
        @media (max-width: 480px) {
            .profile-select {
                grid-template-columns: 1fr;
            }
            
            .tasks-grid.misha {
                grid-template-columns: 1fr;
            }

            .timer-countdown {
                font-size: 3.5em;
            }

            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body data-theme="light">
    <div class="container">
        <!-- Landing Page -->
        <div id="landing" class="landing-page">
            <div class="header">
                <h1>Family Dashboard üè†</h1>
                <button class="theme-toggle" onclick="toggleTheme()">üåô</button>
            </div>
            <div class="profile-select">
                <button class="profile-btn misha" onclick="showKidView('misha')">
                    <span class="profile-avatar" id="misha-avatar-landing">üëß</span>
                    <div class="profile-name">Misha</div>
                    <div class="profile-stats">
                        <span id="misha-level-preview">Lv 1</span>
                        <span id="misha-stars-preview">‚≠ê 0</span>
                        <span id="misha-coins-preview">ü™ô 0</span>
                        <span id="misha-crabs-preview">ü¶Ä 0</span>
                    </div>
                </button>
                <button class="profile-btn kamia" onclick="showKidView('kamia')">
                    <span class="profile-avatar" id="kamia-avatar-landing">üë©</span>
                    <div class="profile-name">Kamia</div>
                    <div class="profile-stats">
                        <span id="kamia-level-preview">Lv 1</span>
                        <span id="kamia-stars-preview">‚≠ê 0</span>
                        <span id="kamia-coins-preview">ü™ô 0</span>
                        <span id="kamia-crabs-preview">ü¶Ä 0</span>
                    </div>
                </button>
                <button class="profile-btn parent" onclick="showParentView()">
                    <span class="profile-avatar">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</span>
                    <div class="profile-name">Parent View</div>
                </button>
            </div>
        </div>

        <!-- Misha's View -->
        <div id="misha-view" class="kid-view">
            <div class="kid-header">
                <div class="kid-header-top">
                    <div class="kid-info">
                        <span class="kid-avatar" id="misha-avatar">üëß</span>
                        <div class="kid-name-group">
                            <div class="kid-name">Misha</div>
                            <div class="kid-level" id="misha-level">Level 1 Beginner</div>
                        </div>
                    </div>
                    <div class="kid-stats">
                        <div class="stat-item">‚≠ê <span id="misha-stars">0</span></div>
                        <div class="stat-item">ü™ô <span id="misha-coins">0</span></div>
                        <div class="stat-item">ü¶Ä <span id="misha-crabs">0</span></div>
                        <div class="stat-item">üî• <span id="misha-streak">0</span></div>
                    </div>
                </div>
                <div class="xp-bar-container">
                    <div class="xp-bar" id="misha-xp-bar"></div>
                    <div class="xp-text" id="misha-xp-text">0 / 100 XP</div>
                </div>
                <div class="achievements-mini" id="misha-achievements"></div>
            </div>

            <div id="misha-timer-display"></div>

            <div class="explorer-section">
                <div class="explorer-header">
                    <div class="explorer-title">üî≠ Daily Discovery</div>
                    <div class="explorer-subtitle">Learn something amazing today!</div>
                </div>
                <div id="misha-discovery-card"></div>
            </div>

            <div class="quick-actions">
                <button class="quick-btn" onclick="openShop('misha')">
                    üè™ Shop
                </button>
                <button class="quick-btn" onclick="showAchievements('misha')">
                    üèÜ Badges
                </button>
            </div>

            <div class="tasks-grid misha" id="misha-tasks"></div>
            <button class="back-btn" onclick="showLanding()">üè†</button>
        </div>

        <!-- Kamia's View -->
        <div id="kamia-view" class="kid-view">
            <div class="kid-header">
                <div class="kid-header-top">
                    <div class="kid-info">
                        <span class="kid-avatar" id="kamia-avatar">üë©</span>
                        <div class="kid-name-group">
                            <div class="kid-name">Kamia</div>
                            <div class="kid-level" id="kamia-level">Level 1 Beginner</div>
                        </div>
                    </div>
                    <div class="kid-stats">
                        <div class="stat-item">‚≠ê <span id="kamia-stars">0</span></div>
                        <div class="stat-item">ü™ô <span id="kamia-coins">0</span></div>
                        <div class="stat-item">ü¶Ä <span id="kamia-crabs">0</span></div>
                        <div class="stat-item">üî• <span id="kamia-streak">0</span></div>
                    </div>
                </div>
                <div class="xp-bar-container">
                    <div class="xp-bar" id="kamia-xp-bar"></div>
                    <div class="xp-text" id="kamia-xp-text">0 / 100 XP</div>
                </div>
                <div class="achievements-mini" id="kamia-achievements"></div>
            </div>

            <div id="kamia-timer-display"></div>

            <div class="explorer-section">
                <div class="explorer-header">
                    <div class="explorer-title">üî≠ Daily Discovery</div>
                    <div class="explorer-subtitle">Unlock today's fascinating fact!</div>
                </div>
                <div id="kamia-discovery-card"></div>
            </div>

            <div class="quick-actions">
                <button class="quick-btn" onclick="openShop('kamia')">
                    üè™ Shop
                </button>
                <button class="quick-btn" onclick="showAchievements('kamia')">
                    üèÜ Badges
                </button>
            </div>

            <div class="tasks-grid" id="kamia-tasks"></div>
            <button class="back-btn" onclick="showLanding()">üè†</button>
        </div>

        <!-- Parent View -->
        <div id="parent-view" class="parent-view">
            <div class="admin-section">
                <h2>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Parent Dashboard</h2>
                
                <div class="kid-selector">
                    <button onclick="selectKidAdmin('misha')" class="active" id="admin-misha-btn">Misha</button>
                    <button onclick="selectKidAdmin('kamia')" id="admin-kamia-btn">Kamia</button>
                </div>

                <div class="tab-buttons">
                    <button class="tab-btn active" onclick="switchTab('tasks')">üìã Tasks</button>
                    <button class="tab-btn" onclick="switchTab('timers')">‚è∞ Timer Blocks</button>
                    <button class="tab-btn" onclick="switchTab('rewards')">üéÅ Reward Shop</button>
                    <button class="tab-btn" onclick="switchTab('funfacts')">üî≠ Fun Facts</button>
                    <button class="tab-btn" onclick="switchTab('stats')">üìä Stats</button>
                </div>

                <!-- Tasks Tab -->
                <div id="tasks-tab" class="tab-content active">
                    <div class="task-form">
                        <div class="form-group">
                            <label>Emoji</label>
                            <input type="text" id="task-emoji" placeholder="ü¶∑">
                        </div>
                        <div class="form-group">
                            <label>Task Title</label>
                            <input type="text" id="task-title" placeholder="Brush Teeth">
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>XP Reward</label>
                                <input type="number" id="task-xp" value="10" min="1">
                            </div>
                            <div class="form-group">
                                <label>Coins Reward</label>
                                <input type="number" id="task-coins" value="5" min="1">
                            </div>
                        </div>
                        <div class="form-group" id="subtasks-group" style="display: none;">
                            <label>Subtasks (one per line)</label>
                            <textarea id="task-subtasks" rows="3" placeholder="Morning routine&#10;Night routine"></textarea>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="task-recurring" checked> Daily recurring
                            </label>
                        </div>
                        <button class="btn btn-primary" onclick="addTask()">‚ûï Add Task</button>
                    </div>

                    <h3 style="margin-top: 20px;">Current Tasks</h3>
                    <div class="task-list" id="admin-task-list"></div>
                </div>

                <!-- Timer Blocks Tab -->
                <div id="timers-tab" class="tab-content">
                    <div class="timer-form">
                        <div class="form-group">
                            <label>Emoji</label>
                            <input type="text" id="timer-emoji" placeholder="üìö">
                        </div>
                        <div class="form-group">
                            <label>Activity Name</label>
                            <input type="text" id="timer-title" placeholder="Learning Time">
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Start Time</label>
                                <input type="time" id="timer-start">
                            </div>
                            <div class="form-group">
                                <label>End Time</label>
                                <input type="time" id="timer-end">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="timer-requires-tasks"> Requires all tasks complete to unlock
                            </label>
                        </div>
                        <button class="btn btn-primary" onclick="addTimer()">‚ûï Add Timer Block</button>
                    </div>

                    <h3 style="margin-top: 20px;">Timer Blocks</h3>
                    <div class="timer-list" id="admin-timer-list"></div>
                </div>

                <!-- Rewards Tab -->
                <div id="rewards-tab" class="tab-content">
                    <div class="reward-form">
                        <div class="form-group">
                            <label>Reward Name</label>
                            <input type="text" id="reward-name" placeholder="30min Extra iPad">
                        </div>
                        <div class="form-group">
                            <label>Cost (Coins)</label>
                            <input type="number" id="reward-cost" value="50" min="1">
                        </div>
                        <button class="btn btn-primary" onclick="addReward()">‚ûï Add Reward</button>
                    </div>

                    <h3 style="margin-top: 20px;">Available Rewards</h3>
                    <div class="reward-list" id="admin-reward-list"></div>

                    <h3 style="margin-top: 20px;">Purchase History</h3>
                    <div class="purchase-history" id="admin-purchase-history"></div>
                </div>

                <!-- Fun Facts Tab -->
                <div id="funfacts-tab" class="tab-content">
                    <div class="reward-form">
                        <div class="form-group">
                            <label>Emoji</label>
                            <input type="text" id="funfact-emoji" placeholder="ü¶â">
                        </div>
                        <div class="form-group">
                            <label>Topic</label>
                            <input type="text" id="funfact-topic" placeholder="Why do owls fly silently?">
                        </div>
                        <div class="form-group">
                            <label>Simple Fact (for Misha)</label>
                            <textarea id="funfact-simple" rows="2" placeholder="Owls have special soft feathers that make them super quiet when they fly!"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Detailed Fact (for Kamia)</label>
                            <textarea id="funfact-detailed" rows="3" placeholder="Did you know? Owls have specialized feathers with serrated edges that break up turbulent air, allowing them to fly almost completely silently. This gives them a huge advantage when hunting at night!"></textarea>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Reward Crabs ü¶Ä</label>
                                <input type="number" id="funfact-crabs" value="5" min="1">
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="addFunFact()">‚ûï Add Fun Fact</button>
                    </div>

                    <h3 style="margin-top: 20px;">Fun Facts Library <span id="funfact-count"></span></h3>
                    <div class="reward-list" id="admin-funfact-list"></div>
                </div>

                <!-- Stats Tab -->
                <div id="stats-tab" class="tab-content">
                    <div id="admin-stats"></div>
                </div>
            </div>

            <button class="back-btn" onclick="showLanding()">üè†</button>
        </div>
    </div>

    <script>
        // Default PIN: 1234
        const DEFAULT_PIN = '1234';
        let currentAdminKid = 'misha';
        let currentView = 'landing';
        let timerIntervals = {};

        // Fun Facts Database
        const DEFAULT_FUN_FACTS = [
            { id: 1, emoji: 'ü¶â', topic: 'Silent Owl Flight', simple: 'Owls have special soft feathers that make them super quiet when they fly!', detailed: 'Did you know? Owls have specialized feathers with serrated edges that break up turbulent air, allowing them to fly almost completely silently. This gives them a huge advantage when hunting at night!', crabs: 5 },
            { id: 2, emoji: 'ü¶Ä', topic: 'Immortal Crabs', simple: 'Lobsters can keep growing and living for a really really long time!', detailed: 'Did you know? Lobsters and some crabs produce an enzyme called telomerase that repairs their DNA, which theoretically means they could live forever if not eaten by predators or caught by humans!', crabs: 5 },
            { id: 3, emoji: 'üåã', topic: 'Inside a Volcano', simple: 'Volcanoes have super hot melted rock called lava inside them!', detailed: 'Did you know? Inside a volcano is a chamber filled with molten rock called magma, which can reach temperatures of 700-1,300¬∞C (1,300-2,400¬∞F)! When it erupts, we call it lava.', crabs: 5 },
            { id: 4, emoji: 'üêô', topic: 'Octopus Hearts', simple: 'An octopus has THREE hearts!', detailed: 'Did you know? Octopuses have three hearts - two pump blood to the gills, and one pumps blood to the rest of the body. Even cooler: their blood is blue because it uses copper instead of iron!', crabs: 5 },
            { id: 5, emoji: 'üåô', topic: 'The Moon is Escaping', simple: 'The moon is slowly moving away from Earth!', detailed: 'Did you know? The Moon is drifting away from Earth at about 3.8 centimeters (1.5 inches) per year. Millions of years from now, it will be much farther away than it is today!', crabs: 5 },
            { id: 6, emoji: 'ü¶ï', topic: 'T-Rex Arms', simple: 'T-Rex had tiny arms but they were super strong!', detailed: 'Did you know? Despite being only about 3 feet long, a T-Rex\'s arms could lift approximately 400 pounds (180 kg) each. Scientists think they used them to grab prey or help themselves stand up!', crabs: 5 },
            { id: 7, emoji: 'üêù', topic: 'Bee Dance Language', simple: 'Bees do a special dance to tell other bees where flowers are!', detailed: 'Did you know? Honeybees perform a "waggle dance" to communicate the location of flowers to other bees. The angle and duration of the dance tells others exactly how far and in which direction to fly!', crabs: 5 },
            { id: 8, emoji: 'üåà', topic: 'Rainbow Colors', simple: 'Rainbows are made when sunlight goes through water drops!', detailed: 'Did you know? Rainbows form when sunlight enters water droplets, gets bent (refracted), reflects off the back of the droplet, and bends again as it exits. Each color bends at a slightly different angle, creating the rainbow spectrum!', crabs: 5 },
            { id: 9, emoji: 'ü¶é', topic: 'Gecko Feet', simple: 'Geckos can walk on walls and ceilings!', detailed: 'Did you know? Geckos have millions of tiny hair-like structures called setae on their feet. These create a special force called van der Waals force that lets them stick to almost any surface, even glass!', crabs: 5 },
            { id: 10, emoji: '‚ö°', topic: 'Lightning Power', simple: 'Lightning is super hot - even hotter than the sun!', detailed: 'Did you know? A bolt of lightning can heat the air around it to temperatures five times hotter than the surface of the sun - about 30,000¬∞C (54,000¬∞F)! That\'s why it glows so bright.', crabs: 5 },
            { id: 11, emoji: 'üê¨', topic: 'Dolphin Names', simple: 'Dolphins have names for each other!', detailed: 'Did you know? Dolphins develop unique whistles that function like names. They use these "signature whistles" to call out to specific individuals, and even respond when they hear their own name!', crabs: 5 },
            { id: 12, emoji: 'üåü', topic: 'Stars are Old Light', simple: 'When you see stars, you\'re looking at light from a long time ago!', detailed: 'Did you know? Stars are so far away that their light takes years to reach us. When you look at a star, you\'re actually seeing what it looked like years ago - it\'s like looking back in time!', crabs: 5 },
            { id: 13, emoji: 'ü¶ò', topic: 'Kangaroo Hopping', simple: 'Kangaroos can\'t walk backwards!', detailed: 'Did you know? Kangaroos are unable to walk backwards due to their large tail and leg structure. This is why the kangaroo and emu (which also can\'t walk backwards) are on Australia\'s coat of arms - symbolizing forward progress!', crabs: 5 },
            { id: 14, emoji: 'üçÑ', topic: 'Giant Mushrooms', simple: 'The biggest living thing on Earth is a mushroom!', detailed: 'Did you know? The largest living organism on Earth is a honey fungus in Oregon that covers 2,385 acres (about 1,665 football fields) and is estimated to be over 2,400 years old!', crabs: 5 },
            { id: 15, emoji: 'ü¶à', topic: 'Shark Age', simple: 'Sharks are older than trees!', detailed: 'Did you know? Sharks have been around for over 400 million years, while trees only appeared about 350 million years ago. This means sharks existed before there were trees on Earth!', crabs: 5 },
            { id: 16, emoji: 'üåä', topic: 'Ocean Depth', simple: 'The ocean is really really deep - deeper than Mount Everest is tall!', detailed: 'Did you know? The deepest part of the ocean (the Mariana Trench) is about 11,000 meters (36,000 feet) deep. If you put Mount Everest in there, the peak would still be over a mile underwater!', crabs: 5 },
            { id: 17, emoji: 'ü¶á', topic: 'Bat Super Senses', simple: 'Bats use sound to see in the dark!', detailed: 'Did you know? Bats use echolocation - they make high-pitched sounds and listen to the echoes that bounce back. This lets them "see" using sound, creating a detailed picture of their surroundings even in complete darkness!', crabs: 5 },
            { id: 18, emoji: 'üå≤', topic: 'Tree Talking', simple: 'Trees can talk to each other underground!', detailed: 'Did you know? Trees communicate through an underground network of fungal threads called the "wood wide web." They can share nutrients, send warning signals about insects, and even help sick trees by sending them resources!', crabs: 5 },
            { id: 19, emoji: 'üêß', topic: 'Penguin Proposals', simple: 'Penguins give rocks as presents when they fall in love!', detailed: 'Did you know? Male penguins search for the smoothest, most perfect pebble to present to a female penguin as a proposal. If she accepts, she places it in her nest and they become partners!', crabs: 5 },
            { id: 20, emoji: 'üî•', topic: 'Fire Rainbows', simple: 'There are rainbows made of fire!', detailed: 'Did you know? "Fire rainbows" (circumhorizontal arcs) occur when sunlight passes through ice crystals in very high cirrus clouds at a specific angle. They look like flames in the sky but are actually ice and light!', crabs: 5 },
            { id: 21, emoji: 'ü¶ã', topic: 'Butterfly Memory', simple: 'Butterflies remember things from when they were caterpillars!', detailed: 'Did you know? Even though a caterpillar completely transforms into a butterfly (liquifying in the process), studies show butterflies can remember things they learned as caterpillars. Their memories survive metamorphosis!', crabs: 5 },
            { id: 22, emoji: 'üåç', topic: 'Earth\'s Spin', simple: 'The Earth is spinning really fast!', detailed: 'Did you know? Earth spins at about 1,670 kilometers per hour (1,040 mph) at the equator. You don\'t feel it because everything around you is moving at the same speed, including the atmosphere!', crabs: 5 },
            { id: 23, emoji: 'üêò', topic: 'Elephant Memory', simple: 'Elephants never forget!', detailed: 'Did you know? Elephants have incredible memories and can remember other elephants for decades. They can recall water hole locations, migration routes, and even distinguish between human voices and languages!', crabs: 5 },
            { id: 24, emoji: '‚ùÑÔ∏è', topic: 'Unique Snowflakes', simple: 'Every snowflake is different!', detailed: 'Did you know? No two snowflakes are exactly alike because each ice crystal takes a unique path through the atmosphere, encountering different temperatures and humidity levels, creating one-of-a-kind patterns!', crabs: 5 },
            { id: 25, emoji: 'ü¶í', topic: 'Giraffe Sounds', simple: 'Giraffes hum to each other at night!', detailed: 'Did you know? Scientists recently discovered that giraffes hum to each other at night at frequencies around 92 Hz. For a long time, people thought giraffes were silent animals!', crabs: 5 },
            { id: 26, emoji: 'üå∫', topic: 'Flower Math', simple: 'Flowers use secret math patterns!', detailed: 'Did you know? Many flowers follow the Fibonacci sequence in their petal counts (3, 5, 8, 13, 21...). This mathematical pattern appears throughout nature and helps flowers arrange their petals efficiently!', crabs: 5 },
            { id: 27, emoji: 'ü¶ú', topic: 'Parrot Colors', simple: 'Parrots don\'t have green pigment!', detailed: 'Did you know? Green parrots don\'t actually have green pigment in their feathers. The green color comes from yellow pigments combined with the blue structural color of their feathers - it\'s an optical illusion!', crabs: 5 },
            { id: 28, emoji: 'üåÄ', topic: 'Water Spirals', simple: 'Water spins different directions in different parts of the world!', detailed: 'Did you know? Due to the Coriolis effect caused by Earth\'s rotation, hurricanes spin counterclockwise in the Northern Hemisphere and clockwise in the Southern Hemisphere. The same applies to large-scale ocean currents!', crabs: 5 },
            { id: 29, emoji: 'üêª', topic: 'Bear Hibernation', simple: 'Bears sleep through winter without going to the bathroom!', detailed: 'Did you know? During hibernation, bears don\'t eat, drink, urinate, or defecate for months. Their bodies recycle waste and can even build new muscle mass while sleeping - something humans can\'t do!', crabs: 5 },
            { id: 30, emoji: 'üé®', topic: 'Mantis Shrimp Vision', simple: 'Mantis shrimp can see way more colors than we can!', detailed: 'Did you know? Mantis shrimp have 16 color receptors (humans have 3). They can see ultraviolet, infrared, and polarized light. They experience a rainbow of colors we can\'t even imagine!', crabs: 5 }
        ];

        // Level titles
        const LEVEL_TITLES = {
            1: 'Beginner', 2: 'Explorer', 3: 'Achiever', 4: 'Champion',
            5: 'Hero', 6: 'Legend', 7: 'Master', 8: 'Epic',
            9: 'Superstar', 10: 'Ultimate'
        };

        // XP needed per level
        function getXPForLevel(level) {
            return level * 100;
        }

        // Avatar unlocks
        const AVATAR_UNLOCKS = {
            1: 'üëß', 2: 'üòä', 3: 'üåü', 4: 'üé®', 5: 'ü¶Ñ',
            6: 'üöÄ', 7: 'üëë', 8: 'üèÜ', 9: 'üíé', 10: 'üî•'
        };

        // Achievement definitions
        const ACHIEVEMENTS = [
            { id: 'earlybird', name: 'Early Bird', emoji: 'üåÖ', check: (kid, data) => {
                const now = new Date();
                return now.getHours() < 9 && data[kid].tasks.every(t => t.completed);
            }},
            { id: 'perfectweek', name: 'Perfect Week', emoji: 'üèÜ', check: (kid, data) => {
                return data[kid].streak >= 7;
            }},
            { id: 'helperhero', name: 'Helper Hero', emoji: 'ü¶∏', check: (kid, data) => {
                return data[kid].tasksCompletedToday >= 10;
            }},
            { id: 'speeddemon', name: 'Speed Demon', emoji: '‚ö°', check: (kid, data) => {
                return data[kid].speedDemonUnlocked;
            }}
        ];

        // Audio Context for sound effects
        function playCompletionSound() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = 523.25; // C5
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.5);
                
                setTimeout(() => {
                    oscillator.frequency.value = 659.25; // E5
                    const osc2 = audioContext.createOscillator();
                    const gain2 = audioContext.createGain();
                    osc2.connect(gain2);
                    gain2.connect(audioContext.destination);
                    osc2.frequency.value = 659.25;
                    gain2.gain.setValueAtTime(0.3, audioContext.currentTime);
                    gain2.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                    osc2.start(audioContext.currentTime);
                    osc2.stop(audioContext.currentTime + 0.5);
                }, 100);
            } catch (e) {
                console.log('Audio not supported');
            }
        }

        // Initialize data structure
        function initData() {
            const defaultData = {
                pin: DEFAULT_PIN,
                theme: 'light',
                rewardShop: [
                    { id: 1, name: '30min Extra iPad', cost: 50 },
                    { id: 2, name: 'Pick Dinner', cost: 100 },
                    { id: 3, name: 'Stay Up 30min Late', cost: 75 },
                    { id: 4, name: 'Movie Night Choice', cost: 60 },
                    { id: 5, name: 'Ice Cream Trip', cost: 80 }
                ],
                misha: {
                    tasks: [
                        { id: 1, emoji: 'ü¶∑', title: 'Teeth', completed: false, recurring: true, xp: 10, coins: 5 },
                        { id: 2, emoji: 'üéí', title: 'School Bag', completed: false, recurring: true, xp: 10, coins: 5 },
                        { id: 3, emoji: 'üßπ', title: 'Tidy Room', completed: false, recurring: true, xp: 15, coins: 8 },
                        { id: 4, emoji: 'üìö', title: 'Homework', completed: false, recurring: true, xp: 20, coins: 10 },
                        { id: 5, emoji: 'ü•£', title: 'Breakfast', completed: false, recurring: true, xp: 10, coins: 5 },
                        { id: 6, emoji: 'üò¥', title: 'Bedtime', completed: false, recurring: true, xp: 10, coins: 5 }
                    ],
                    timerBlocks: [
                        { id: 1, emoji: 'üìö', title: 'Learning Time', startTime: '10:00', endTime: '11:00', requiresTasks: false }
                    ],
                    stars: 0,
                    streak: 0,
                    xp: 0,
                    level: 1,
                    coins: 0,
                    crabs: 0,
                    achievements: [],
                    purchaseHistory: [],
                    lastCompletionDate: null,
                    tasksCompletedToday: 0,
                    speedDemonUnlocked: false,
                    discoveryCompleted: false,
                    discoveryHistory: []
                },
                kamia: {
                    tasks: [
                        { id: 1, emoji: 'ü¶∑', title: 'Morning Routine', completed: false, recurring: true, xp: 15, coins: 8, subtasks: ['Brush teeth', 'Wash face', 'Get dressed'] },
                        { id: 2, emoji: 'üìö', title: 'Study Session', completed: false, recurring: true, xp: 25, coins: 12, subtasks: ['Math homework', 'Reading assignment'] },
                        { id: 3, emoji: 'üéµ', title: 'Music Practice', completed: false, recurring: true, xp: 20, coins: 10 },
                        { id: 4, emoji: 'üßπ', title: 'Room Cleanup', completed: false, recurring: true, xp: 15, coins: 8, subtasks: ['Make bed', 'Organize desk', 'Laundry basket'] },
                        { id: 5, emoji: 'üí™', title: 'Exercise', completed: false, recurring: true, xp: 20, coins: 10 },
                        { id: 6, emoji: 'üò¥', title: 'Night Routine', completed: false, recurring: true, xp: 15, coins: 8, subtasks: ['Brush teeth', 'Pack bag', 'Set alarm'] }
                    ],
                    timerBlocks: [
                        { id: 1, emoji: 'üéÆ', title: 'iPad Time', startTime: '16:00', endTime: '17:00', requiresTasks: true }
                    ],
                    stars: 0,
                    streak: 0,
                    xp: 0,
                    level: 1,
                    coins: 0,
                    crabs: 0,
                    achievements: [],
                    purchaseHistory: [],
                    lastCompletionDate: null,
                    tasksCompletedToday: 0,
                    speedDemonUnlocked: false,
                    discoveryCompleted: false,
                    discoveryHistory: []
                },
                funFacts: DEFAULT_FUN_FACTS,
                lastResetDate: new Date().toDateString()
            };

            const stored = localStorage.getItem('familyDashboard');
            if (!stored) {
                localStorage.setItem('familyDashboard', JSON.stringify(defaultData));
                return defaultData;
            }
            
            // Merge with defaults for new properties
            const existingData = JSON.parse(stored);
            return mergeDefaults(existingData, defaultData);
        }

        function mergeDefaults(existing, defaults) {
            for (let key in defaults) {
                if (typeof defaults[key] === 'object' && !Array.isArray(defaults[key]) && defaults[key] !== null) {
                    existing[key] = existing[key] || {};
                    mergeDefaults(existing[key], defaults[key]);
                } else if (existing[key] === undefined) {
                    existing[key] = defaults[key];
                }
            }
            return existing;
        }

        function saveData(data) {
            localStorage.setItem('familyDashboard', JSON.stringify(data));
        }

        function getData() {
            const data = initData();
            // Ensure kid data fields are never undefined
            ['misha', 'kamia'].forEach(kid => {
                if (data[kid]) {
                    data[kid].xp = data[kid].xp || 0;
                    data[kid].coins = data[kid].coins || 0;
                    data[kid].crabs = data[kid].crabs || 0;
                    data[kid].stars = data[kid].stars || 0;
                    data[kid].streak = data[kid].streak || 0;
                    data[kid].level = data[kid].level || 1;
                    data[kid].achievements = data[kid].achievements || [];
                    data[kid].purchaseHistory = data[kid].purchaseHistory || [];
                    data[kid].tasksCompletedToday = data[kid].tasksCompletedToday || 0;
                }
            });
            return data;
        }

        // Theme Toggle
        function toggleTheme() {
            const body = document.body;
            const currentTheme = body.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            body.setAttribute('data-theme', newTheme);
            
            const data = getData();
            data.theme = newTheme;
            saveData(data);

            const toggle = document.querySelector('.theme-toggle');
            toggle.textContent = newTheme === 'light' ? 'üåô' : '‚òÄÔ∏è';
        }

        // Daily Reset
        function checkDailyReset() {
            const data = getData();
            const today = new Date().toDateString();
            
            if (data.lastResetDate !== today) {
                ['misha', 'kamia'].forEach(kid => {
                    const allCompleted = data[kid].tasks.every(t => t.completed);
                    
                    // Bonus XP and coins for completing all tasks
                    if (allCompleted && data[kid].tasksCompletedToday > 0) {
                        data[kid].xp += 50; // Daily bonus XP
                        data[kid].coins += 20; // Daily bonus coins
                        
                        const lastDate = new Date(data[kid].lastCompletionDate);
                        const yesterday = new Date();
                        yesterday.setDate(yesterday.getDate() - 1);
                        
                        if (lastDate.toDateString() === yesterday.toDateString()) {
                            data[kid].streak++;
                        } else {
                            data[kid].streak = 0;
                        }
                    } else {
                        data[kid].streak = 0;
                    }

                    // Reset daily tasks
                    data[kid].tasks.forEach(task => {
                        if (task.recurring) {
                            task.completed = false;
                        }
                    });

                    // Reset daily counters
                    data[kid].stars = 0;
                    data[kid].tasksCompletedToday = 0;
                    data[kid].speedDemonUnlocked = false;
                    data[kid].discoveryCompleted = false;
                });

                data.lastResetDate = today;
                saveData(data);
            }
        }

        // Fun Facts / Discovery System
        function getDailyFact() {
            const data = getData();
            const today = new Date();
            const dayOfYear = Math.floor((today - new Date(today.getFullYear(), 0, 0)) / 1000 / 60 / 60 / 24);
            const factIndex = dayOfYear % data.funFacts.length;
            return data.funFacts[factIndex];
        }

        function renderDiscoveryCard(kid) {
            const data = getData();
            const container = document.getElementById(`${kid}-discovery-card`);
            const fact = getDailyFact();
            const completed = data[kid].discoveryCompleted;
            
            if (!completed) {
                // Locked treasure chest
                container.innerHTML = `
                    <div class="discovery-card locked" onclick="revealDiscovery('${kid}')">
                        <div class="discovery-locked-content">
                            <div class="discovery-treasure">üì¶‚ú®</div>
                            <div class="discovery-locked-text">Tap to discover today's fact!</div>
                        </div>
                    </div>
                `;
            } else {
                // Revealed fact
                const factText = kid === 'misha' ? fact.simple : fact.detailed;
                container.innerHTML = `
                    <div class="discovery-card discovery-completed">
                        <div class="discovery-unlocked-content">
                            <div class="discovery-emoji">${fact.emoji}</div>
                            <div class="discovery-topic">${fact.topic}</div>
                            <div class="discovery-fact">${factText}</div>
                            <div class="discovery-reward">Already earned +${fact.crabs} ü¶Ä</div>
                        </div>
                    </div>
                `;
            }
        }

        function revealDiscovery(kid) {
            const data = getData();
            
            if (data[kid].discoveryCompleted) {
                return; // Already completed today
            }
            
            const fact = getDailyFact();
            data[kid].discoveryCompleted = true;
            data[kid].crabs += fact.crabs;
            data[kid].discoveryHistory.push({
                factId: fact.id,
                date: new Date().toISOString()
            });
            
            saveData(data);
            
            // Play reveal animation and sound
            playCompletionSound();
            
            // Show treasure reveal animation
            const container = document.getElementById(`${kid}-discovery-card`);
            const factText = kid === 'misha' ? fact.simple : fact.detailed;
            
            // Confetti burst
            for (let i = 0; i < 30; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.backgroundColor = ['#667eea', '#764ba2', '#FFD700', '#FFA500'][Math.floor(Math.random() * 4)];
                    document.body.appendChild(confetti);
                    setTimeout(() => confetti.remove(), 3000);
                }, i * 20);
            }
            
            // Update card with revealed content
            container.innerHTML = `
                <div class="discovery-card">
                    <div class="discovery-unlocked-content">
                        <div class="discovery-emoji">${fact.emoji}</div>
                        <div class="discovery-topic">${fact.topic}</div>
                        <div class="discovery-fact">${factText}</div>
                        <div class="discovery-reward">+${fact.crabs} ü¶Ä Earned!</div>
                    </div>
                </div>
            `;
            
            updateKidStats(kid);
            updateLandingStats();
        }

        function getTotalFunFacts() {
            const data = getData();
            return data.funFacts ? data.funFacts.length : 0;
        }

        // XP and Level System
        function addXP(kid, amount) {
            const data = getData();
            data[kid].xp += amount;
            
            // Check for level up
            const xpNeeded = getXPForLevel(data[kid].level);
            if (data[kid].xp >= xpNeeded) {
                data[kid].xp -= xpNeeded;
                data[kid].level++;
                saveData(data);
                showLevelUpAnimation(kid);
                updateKidStats(kid);
                return true;
            }
            
            saveData(data);
            updateKidStats(kid);
            return false;
        }

        function showLevelUpAnimation(kid) {
            const data = getData();
            const level = data[kid].level;
            const title = LEVEL_TITLES[level] || 'Master';
            
            playCompletionSound();
            
            const popup = document.createElement('div');
            popup.className = 'levelup-popup';
            popup.innerHTML = `
                <div class="levelup-text">LEVEL UP!</div>
                <div style="font-size: 3em; margin: 20px 0;">${AVATAR_UNLOCKS[level] || '‚≠ê'}</div>
                <div style="font-size: 2em;">Level ${level}</div>
                <div style="font-size: 1.5em; opacity: 0.9;">${title}</div>
            `;
            document.body.appendChild(popup);
            
            // Confetti
            for (let i = 0; i < 100; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.backgroundColor = ['#FFD700', '#FFA500', '#FF6B9D', '#9B59D0', '#4CAF50'][Math.floor(Math.random() * 5)];
                    document.body.appendChild(confetti);
                    setTimeout(() => confetti.remove(), 3000);
                }, i * 20);
            }
            
            setTimeout(() => popup.remove(), 3000);
        }

        // Check and unlock achievements
        function checkAchievements(kid) {
            const data = getData();
            let newAchievements = false;
            
            ACHIEVEMENTS.forEach(ach => {
                if (!data[kid].achievements.includes(ach.id) && ach.check(kid, data)) {
                    data[kid].achievements.push(ach.id);
                    data[kid].xp += 30; // Bonus XP for achievement
                    data[kid].coins += 15; // Bonus coins
                    newAchievements = true;
                    
                    // Show achievement popup
                    setTimeout(() => {
                        const popup = document.createElement('div');
                        popup.className = 'completion-popup';
                        popup.innerHTML = `
                            <div class="popup-emoji">${ach.emoji}</div>
                            <div class="popup-text">Achievement Unlocked!</div>
                            <div class="popup-subtext">${ach.name}</div>
                        `;
                        document.body.appendChild(popup);
                        setTimeout(() => popup.remove(), 2500);
                    }, 1500);
                }
            });
            
            if (newAchievements) {
                saveData(data);
                updateKidStats(kid);
            }
        }

        // Navigation
        function showLanding() {
            // Stop all timers
            Object.keys(timerIntervals).forEach(key => clearInterval(timerIntervals[key]));
            timerIntervals = {};
            
            document.getElementById('landing').style.display = 'block';
            document.getElementById('misha-view').classList.remove('active');
            document.getElementById('kamia-view').classList.remove('active');
            document.getElementById('parent-view').classList.remove('active');
            currentView = 'landing';
            updateLandingStats();
        }

        function showKidView(kid) {
            checkDailyReset();
            document.getElementById('landing').style.display = 'none';
            document.getElementById(`${kid}-view`).classList.add('active');
            currentView = kid;
            renderKidTasks(kid);
            updateKidStats(kid);
            renderTimerDisplay(kid);
            renderDiscoveryCard(kid);
            startTimerUpdates(kid);
        }

        function showParentView() {
            showPinDialog();
        }

        // PIN Protection
        function showPinDialog() {
            const overlay = document.createElement('div');
            overlay.className = 'pin-screen';
            overlay.innerHTML = `
                <div class="pin-dialog">
                    <h2>Enter PIN</h2>
                    <input type="password" class="pin-input" id="pin-input" maxlength="4" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                    <div class="pin-buttons">
                        ${[1,2,3,4,5,6,7,8,9,'‚Üê',0,'‚úì'].map(n => 
                            `<button class="pin-btn" onclick="pinPress('${n}')">${n}</button>`
                        ).join('')}
                    </div>
                    <p style="margin-top: 20px; color: var(--text-secondary);">Default PIN: 1234<br>Type on keyboard or click buttons</p>
                </div>
            `;
            document.body.appendChild(overlay);

            // Focus the input for immediate typing
            const input = document.getElementById('pin-input');
            setTimeout(() => input.focus(), 100);

            // Handle keyboard Enter key
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    checkPin();
                }
            });

            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) {
                    document.body.removeChild(overlay);
                }
            });
        }

        function pinPress(key) {
            const input = document.getElementById('pin-input');

            if (key === '‚Üê') {
                input.value = input.value.slice(0, -1);
            } else if (key === '‚úì') {
                checkPin();
            } else if (input.value.length < 4) {
                input.value += key;
            }
        }

        function checkPin() {
            const input = document.getElementById('pin-input');
            const data = getData();

            if (input.value === data.pin) {
                document.querySelector('.pin-screen').remove();
                document.getElementById('landing').style.display = 'none';
                document.getElementById('parent-view').classList.add('active');
                currentView = 'parent';
                renderAdminView();
            } else {
                input.value = '';
                input.style.borderColor = '#EF5350';
                setTimeout(() => {
                    input.style.borderColor = '';
                    input.focus();
                }, 500);
            }
        }

        // Timer Display and Logic
        function renderTimerDisplay(kid) {
            const data = getData();
            const container = document.getElementById(`${kid}-timer-display`);
            const now = new Date();
            const currentMinutes = now.getHours() * 60 + now.getMinutes();
            
            let activeBlock = null;
            let nextBlock = null;
            
            // Find active or next timer block
            data[kid].timerBlocks.forEach(block => {
                const [startH, startM] = block.startTime.split(':').map(Number);
                const [endH, endM] = block.endTime.split(':').map(Number);
                const startMinutes = startH * 60 + startM;
                const endMinutes = endH * 60 + endM;
                
                if (currentMinutes >= startMinutes && currentMinutes < endMinutes) {
                    activeBlock = { ...block, startMinutes, endMinutes };
                } else if (currentMinutes < startMinutes) {
                    if (!nextBlock || startMinutes < nextBlock.startMinutes) {
                        nextBlock = { ...block, startMinutes, endMinutes };
                    }
                }
            });
            
            if (activeBlock) {
                // Check if tasks are required and completed
                const tasksRequired = activeBlock.requiresTasks;
                const allTasksComplete = data[kid].tasks.every(t => t.completed);
                
                if (tasksRequired && !allTasksComplete) {
                    container.innerHTML = `
                        <div class="no-timer">
                            <div style="font-size: 3em; margin-bottom: 15px;">üîí</div>
                            <div style="font-size: 1.3em; font-weight: bold; margin-bottom: 10px;">
                                ${activeBlock.emoji} ${activeBlock.title} is locked!
                            </div>
                            <div style="font-size: 1.1em;">
                                Complete all tasks to unlock this activity! ‚ú®
                            </div>
                        </div>
                    `;
                } else {
                    const remaining = (activeBlock.endMinutes - currentMinutes) * 60;
                    renderActiveTimer(container, activeBlock, remaining, kid);
                }
            } else if (nextBlock) {
                const minutesUntil = nextBlock.startMinutes - currentMinutes;
                container.innerHTML = `
                    <div class="no-timer">
                        <div style="font-size: 3em; margin-bottom: 15px;">‚è∞</div>
                        <div style="font-size: 1.3em; font-weight: bold;">
                            ${nextBlock.emoji} ${nextBlock.title}
                        </div>
                        <div style="font-size: 1.1em; margin-top: 10px;">
                            Starts in ${minutesUntil} minute${minutesUntil !== 1 ? 's' : ''}!
                        </div>
                    </div>
                `;
            } else {
                container.innerHTML = `
                    <div class="no-timer">
                        <div style="font-size: 3em; margin-bottom: 15px;">üåô</div>
                        <div style="font-size: 1.3em;">No scheduled activities right now</div>
                    </div>
                `;
            }
        }

        function renderActiveTimer(container, block, remainingSeconds, kid) {
            const data = getData();
            const totalDuration = (block.endMinutes - block.startMinutes) * 60;
            const progress = 1 - (remainingSeconds / totalDuration);
            
            let colorClass = 'green';
            if (progress > 0.8) colorClass = 'red';
            else if (progress > 0.5) colorClass = 'yellow';
            
            const minutes = Math.floor(remainingSeconds / 60);
            const seconds = remainingSeconds % 60;
            const display = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            
            // Find next block
            const now = new Date();
            const currentMinutes = now.getHours() * 60 + now.getMinutes();
            let nextBlock = null;
            data[kid].timerBlocks.forEach(b => {
                const [startH, startM] = b.startTime.split(':').map(Number);
                const startMinutes = startH * 60 + startM;
                if (startMinutes > block.endMinutes) {
                    if (!nextBlock || startMinutes < nextBlock.startMinutes) {
                        nextBlock = { ...b, startMinutes };
                    }
                }
            });
            
            let nextActivityHTML = '';
            if (nextBlock) {
                const minutesUntilNext = nextBlock.startMinutes - currentMinutes;
                nextActivityHTML = `
                    <div class="next-activity">
                        Up next: ${nextBlock.emoji} ${nextBlock.title} in ${minutesUntilNext} minutes!
                    </div>
                `;
            }
            
            container.innerHTML = `
                <div class="timer-block">
                    <div class="timer-activity">${block.emoji} ${block.title}</div>
                    <div class="timer-countdown ${colorClass}" id="${kid}-timer-countdown">${display}</div>
                    <div class="timer-label">Time Remaining</div>
                    ${nextActivityHTML}
                </div>
            `;
        }

        function startTimerUpdates(kid) {
            if (timerIntervals[kid]) {
                clearInterval(timerIntervals[kid]);
            }
            
            timerIntervals[kid] = setInterval(() => {
                if (currentView === kid) {
                    renderTimerDisplay(kid);
                }
            }, 1000);
        }

        // Render Kid Tasks
        function renderKidTasks(kid) {
            const data = getData();
            const container = document.getElementById(`${kid}-tasks`);
            container.innerHTML = '';

            data[kid].tasks.forEach(task => {
                const card = document.createElement('div');
                card.className = `task-card ${kid} ${task.completed ? 'completed' : ''}`;
                card.onclick = () => toggleTask(kid, task.id);

                let subtasksHTML = '';
                if (task.subtasks && task.subtasks.length > 0) {
                    subtasksHTML = `<div class="task-subtasks">
                        ${task.subtasks.map(st => `<div class="subtask">${st}</div>`).join('')}
                    </div>`;
                }

                const xpDisplay = `<div class="task-xp">+${task.xp} XP ‚Ä¢ +${task.coins} ü™ô</div>`;

                card.innerHTML = `
                    <span class="task-emoji">${task.emoji}</span>
                    <div class="task-title">${task.title}</div>
                    ${subtasksHTML}
                    ${!task.completed ? xpDisplay : ''}
                    <span class="checkmark">‚úÖ</span>
                `;

                container.appendChild(card);
            });
        }

        // Toggle Task Completion
        function toggleTask(kid, taskId) {
            const data = getData();
            const task = data[kid].tasks.find(t => t.id === taskId);
            
            if (!task.completed) {
                // COMPLETE THE TASK
                const taskCreatedTime = Date.now(); // In real app, track when task appears
                
                task.completed = true;
                data[kid].stars++;
                data[kid].coins += task.coins || 5;
                data[kid].tasksCompletedToday++;
                data[kid].lastCompletionDate = new Date().toISOString();
                
                // Check for speed demon (task done within 1 minute of appearing)
                // For demo, randomly unlock this sometimes
                if (Math.random() < 0.2) {
                    data[kid].speedDemonUnlocked = true;
                }
                
                saveData(data);
                
                const leveledUp = addXP(kid, task.xp || 10);
                
                renderKidTasks(kid);
                updateKidStats(kid);
                updateLandingStats();
                renderTimerDisplay(kid); // Update in case this unlocks a timer
                
                if (!leveledUp) {
                    showCompletionAnimation(task.xp, task.coins);
                }
                
                // Check achievements after a delay to allow animations to play
                setTimeout(() => checkAchievements(kid), 2000);
            } else {
                // UNCOMPLETE THE TASK (allow mistakes to be fixed)
                task.completed = false;
                data[kid].stars = Math.max(0, data[kid].stars - 1);
                data[kid].coins = Math.max(0, data[kid].coins - (task.coins || 5));
                data[kid].xp = Math.max(0, data[kid].xp - (task.xp || 10));
                data[kid].tasksCompletedToday = Math.max(0, data[kid].tasksCompletedToday - 1);
                
                // Check if level should decrease (rare but possible if unchecking many tasks)
                while (data[kid].level > 1 && data[kid].xp < 0) {
                    data[kid].level--;
                    data[kid].xp += getXPForLevel(data[kid].level);
                }
                
                saveData(data);
                renderKidTasks(kid);
                updateKidStats(kid);
                updateLandingStats();
                renderTimerDisplay(kid);
            }
        }

        // Update Stats
        function updateKidStats(kid) {
            const data = getData();
            const kidData = data[kid];
            
            // Update level and title
            const levelTitle = LEVEL_TITLES[kidData.level] || 'Master';
            document.getElementById(`${kid}-level`).textContent = `Level ${kidData.level} ${levelTitle}`;
            
            // Update avatar based on level
            const avatar = AVATAR_UNLOCKS[kidData.level] || 'üëß';
            document.getElementById(`${kid}-avatar`).textContent = avatar;
            
            // Update stats
            document.getElementById(`${kid}-stars`).textContent = kidData.stars;
            document.getElementById(`${kid}-coins`).textContent = kidData.coins;
            document.getElementById(`${kid}-crabs`).textContent = kidData.crabs;
            document.getElementById(`${kid}-streak`).textContent = kidData.streak;
            
            // Update XP bar
            const xpNeeded = getXPForLevel(kidData.level);
            const xpPercent = (kidData.xp / xpNeeded) * 100;
            document.getElementById(`${kid}-xp-bar`).style.width = xpPercent + '%';
            document.getElementById(`${kid}-xp-text`).textContent = `${kidData.xp} / ${xpNeeded} XP`;
            
            // Update achievements display
            const achContainer = document.getElementById(`${kid}-achievements`);
            achContainer.innerHTML = ACHIEVEMENTS.map(ach => {
                const unlocked = kidData.achievements.includes(ach.id);
                return `<span class="achievement-badge ${unlocked ? 'unlocked' : ''}" title="${ach.name}">${ach.emoji}</span>`;
            }).join('');
        }

        function updateLandingStats() {
            const data = getData();
            ['misha', 'kamia'].forEach(kid => {
                const kidData = data[kid];
                const levelTitle = LEVEL_TITLES[kidData.level] || 'Master';
                const avatar = AVATAR_UNLOCKS[kidData.level] || (kid === 'misha' ? 'üëß' : 'üë©');
                
                document.getElementById(`${kid}-avatar-landing`).textContent = avatar;
                document.getElementById(`${kid}-level-preview`).textContent = `Lv ${kidData.level}`;
                document.getElementById(`${kid}-stars-preview`).textContent = `‚≠ê ${kidData.stars}`;
                document.getElementById(`${kid}-coins-preview`).textContent = `ü™ô ${kidData.coins}`;
                document.getElementById(`${kid}-crabs-preview`).textContent = `ü¶Ä ${kidData.crabs}`;
            });
        }

        // Completion Animation
        function showCompletionAnimation(xp, coins) {
            playCompletionSound();
            
            // Confetti
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.backgroundColor = ['#FF6B9D', '#9B59D0', '#FFA726', '#4CAF50', '#FFD700'][Math.floor(Math.random() * 5)];
                    confetti.style.animationDelay = Math.random() * 0.5 + 's';
                    document.body.appendChild(confetti);
                    setTimeout(() => confetti.remove(), 3000);
                }, i * 30);
            }

            // Popup
            const popup = document.createElement('div');
            popup.className = 'completion-popup';
            popup.innerHTML = `
                <div class="popup-emoji">üéâ</div>
                <div class="popup-text">Great Job!</div>
                <div class="popup-subtext">+${xp} XP ‚Ä¢ +${coins} ü™ô</div>
            `;
            document.body.appendChild(popup);
            setTimeout(() => popup.remove(), 2000);
        }

        // Reward Shop
        function openShop(kid) {
            const data = getData();
            const kidData = data[kid];
            
            const modal = document.createElement('div');
            modal.className = 'shop-modal';
            modal.onclick = (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            };
            
            const shopItems = data.rewardShop.map(item => {
                const canBuy = kidData.coins >= item.cost;
                return `
                    <div class="shop-item">
                        <div class="shop-item-info">
                            <div class="shop-item-name">${item.name}</div>
                            <div class="shop-item-cost">ü™ô ${item.cost}</div>
                        </div>
                        <button class="shop-item-btn" ${!canBuy ? 'disabled' : ''} onclick="buyReward('${kid}', ${item.id})">
                            Buy
                        </button>
                    </div>
                `;
            }).join('');
            
            modal.innerHTML = `
                <div class="shop-content">
                    <button class="shop-close" onclick="this.closest('.shop-modal').remove()">‚úï</button>
                    <div class="shop-header">
                        <h2>üè™ Reward Shop</h2>
                        <div class="shop-balance">ü™ô ${kidData.coins} coins</div>
                    </div>
                    <div class="shop-items">
                        ${shopItems}
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        function buyReward(kid, rewardId) {
            const data = getData();
            const reward = data.rewardShop.find(r => r.id === rewardId);
            
            if (!reward || data[kid].coins < reward.cost) {
                return;
            }
            
            data[kid].coins -= reward.cost;
            data[kid].purchaseHistory.push({
                rewardName: reward.name,
                cost: reward.cost,
                date: new Date().toISOString()
            });
            
            saveData(data);
            updateKidStats(kid);
            
            // Close and reopen shop to update
            document.querySelector('.shop-modal').remove();
            
            // Show success message
            const popup = document.createElement('div');
            popup.className = 'completion-popup';
            popup.innerHTML = `
                <div class="popup-emoji">üéÅ</div>
                <div class="popup-text">Purchased!</div>
                <div class="popup-subtext">${reward.name}</div>
            `;
            document.body.appendChild(popup);
            setTimeout(() => popup.remove(), 2000);
        }

        // Show achievements modal
        function showAchievements(kid) {
            const data = getData();
            const kidData = data[kid];
            
            const modal = document.createElement('div');
            modal.className = 'shop-modal';
            modal.onclick = (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            };
            
            const achievementsList = ACHIEVEMENTS.map(ach => {
                const unlocked = kidData.achievements.includes(ach.id);
                return `
                    <div class="shop-item" style="${!unlocked ? 'opacity: 0.5; filter: grayscale(100%);' : ''}">
                        <div class="shop-item-info">
                            <div style="font-size: 2em; margin-right: 15px;">${ach.emoji}</div>
                            <div>
                                <div class="shop-item-name">${ach.name}</div>
                                <div style="font-size: 0.9em; color: var(--text-secondary);">
                                    ${unlocked ? '‚úÖ Unlocked!' : 'üîí Locked'}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            modal.innerHTML = `
                <div class="shop-content">
                    <button class="shop-close" onclick="this.closest('.shop-modal').remove()">‚úï</button>
                    <div class="shop-header">
                        <h2>üèÜ Achievements</h2>
                        <div>${kidData.achievements.length} / ${ACHIEVEMENTS.length} unlocked</div>
                    </div>
                    <div class="shop-items">
                        ${achievementsList}
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        // Admin Functions
        function switchTab(tabName) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(`${tabName}-tab`).classList.add('active');
            
            if (tabName === 'stats') {
                renderAdminStats();
            } else if (tabName === 'timers') {
                renderAdminTimerList();
            } else if (tabName === 'rewards') {
                renderAdminRewardList();
            } else if (tabName === 'funfacts') {
                renderAdminFunFactList();
            }
        }

        function selectKidAdmin(kid) {
            currentAdminKid = kid;
            document.getElementById('admin-misha-btn').classList.toggle('active', kid === 'misha');
            document.getElementById('admin-kamia-btn').classList.toggle('active', kid === 'kamia');
            document.getElementById('subtasks-group').style.display = kid === 'kamia' ? 'block' : 'none';
            renderAdminTaskList();
            renderAdminTimerList();
        }

        function addTask() {
            const emoji = document.getElementById('task-emoji').value.trim();
            const title = document.getElementById('task-title').value.trim();
            const xp = parseInt(document.getElementById('task-xp').value) || 10;
            const coins = parseInt(document.getElementById('task-coins').value) || 5;
            const subtasksText = document.getElementById('task-subtasks').value.trim();
            const recurring = document.getElementById('task-recurring').checked;

            if (!emoji || !title) {
                alert('Please fill in emoji and title');
                return;
            }

            const data = getData();
            const maxId = Math.max(0, ...data[currentAdminKid].tasks.map(t => t.id));
            
            const task = {
                id: maxId + 1,
                emoji,
                title,
                completed: false,
                recurring,
                xp,
                coins
            };

            if (currentAdminKid === 'kamia' && subtasksText) {
                task.subtasks = subtasksText.split('\n').filter(s => s.trim());
            }

            data[currentAdminKid].tasks.push(task);
            saveData(data);

            // Clear form
            document.getElementById('task-emoji').value = '';
            document.getElementById('task-title').value = '';
            document.getElementById('task-xp').value = '10';
            document.getElementById('task-coins').value = '5';
            document.getElementById('task-subtasks').value = '';

            renderAdminTaskList();
        }

        function deleteTask(taskId) {
            if (!confirm('Delete this task?')) return;

            const data = getData();
            data[currentAdminKid].tasks = data[currentAdminKid].tasks.filter(t => t.id !== taskId);
            saveData(data);
            renderAdminTaskList();
        }

        function renderAdminTaskList() {
            const data = getData();
            const container = document.getElementById('admin-task-list');
            const tasks = data[currentAdminKid].tasks;

            if (tasks.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">No tasks yet</p>';
                return;
            }

            container.innerHTML = tasks.map(task => `
                <div class="task-item">
                    <span class="task-item-emoji">${task.emoji}</span>
                    <div class="task-item-info">
                        <strong>${task.title}</strong>
                        <div style="font-size: 0.9em; color: var(--success);">+${task.xp} XP ‚Ä¢ +${task.coins} ü™ô</div>
                        ${task.subtasks ? `<div style="font-size: 0.9em; color: var(--text-secondary);">${task.subtasks.length} subtasks</div>` : ''}
                        ${task.recurring ? '<div style="font-size: 0.8em; color: var(--success);">üîÑ Daily</div>' : ''}
                    </div>
                    <div class="task-item-actions">
                        <button class="btn-small btn-delete" onclick="deleteTask(${task.id})">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');
        }

        // Timer Block Management
        function addTimer() {
            const emoji = document.getElementById('timer-emoji').value.trim();
            const title = document.getElementById('timer-title').value.trim();
            const startTime = document.getElementById('timer-start').value;
            const endTime = document.getElementById('timer-end').value;
            const requiresTasks = document.getElementById('timer-requires-tasks').checked;

            if (!emoji || !title || !startTime || !endTime) {
                alert('Please fill in all fields');
                return;
            }

            const data = getData();
            const maxId = Math.max(0, ...data[currentAdminKid].timerBlocks.map(t => t.id));
            
            data[currentAdminKid].timerBlocks.push({
                id: maxId + 1,
                emoji,
                title,
                startTime,
                endTime,
                requiresTasks
            });
            
            saveData(data);

            // Clear form
            document.getElementById('timer-emoji').value = '';
            document.getElementById('timer-title').value = '';
            document.getElementById('timer-start').value = '';
            document.getElementById('timer-end').value = '';
            document.getElementById('timer-requires-tasks').checked = false;

            renderAdminTimerList();
        }

        function deleteTimer(timerId) {
            if (!confirm('Delete this timer block?')) return;

            const data = getData();
            data[currentAdminKid].timerBlocks = data[currentAdminKid].timerBlocks.filter(t => t.id !== timerId);
            saveData(data);
            renderAdminTimerList();
        }

        function renderAdminTimerList() {
            const data = getData();
            const container = document.getElementById('admin-timer-list');
            const timers = data[currentAdminKid].timerBlocks;

            if (timers.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">No timer blocks yet</p>';
                return;
            }

            container.innerHTML = timers.map(timer => `
                <div class="timer-item">
                    <span class="timer-item-emoji">${timer.emoji}</span>
                    <div class="timer-item-info">
                        <strong>${timer.title}</strong>
                        <div style="font-size: 0.9em; color: var(--text-secondary);">
                            ${timer.startTime} - ${timer.endTime}
                        </div>
                        ${timer.requiresTasks ? '<div style="font-size: 0.8em; color: var(--warning);">üîí Requires tasks complete</div>' : ''}
                    </div>
                    <div class="timer-item-actions">
                        <button class="btn-small btn-delete" onclick="deleteTimer(${timer.id})">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');
        }

        // Reward Management
        function addReward() {
            const name = document.getElementById('reward-name').value.trim();
            const cost = parseInt(document.getElementById('reward-cost').value) || 50;

            if (!name) {
                alert('Please enter a reward name');
                return;
            }

            const data = getData();
            const maxId = Math.max(0, ...data.rewardShop.map(r => r.id));
            
            data.rewardShop.push({
                id: maxId + 1,
                name,
                cost
            });
            
            saveData(data);

            // Clear form
            document.getElementById('reward-name').value = '';
            document.getElementById('reward-cost').value = '50';

            renderAdminRewardList();
        }

        function deleteReward(rewardId) {
            if (!confirm('Delete this reward?')) return;

            const data = getData();
            data.rewardShop = data.rewardShop.filter(r => r.id !== rewardId);
            saveData(data);
            renderAdminRewardList();
        }

        function renderAdminRewardList() {
            const data = getData();
            const rewardContainer = document.getElementById('admin-reward-list');
            const historyContainer = document.getElementById('admin-purchase-history');

            // Rewards list
            if (data.rewardShop.length === 0) {
                rewardContainer.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">No rewards yet</p>';
            } else {
                rewardContainer.innerHTML = data.rewardShop.map(reward => `
                    <div class="reward-item">
                        <div class="reward-item-info">
                            <strong>${reward.name}</strong>
                            <div style="font-size: 0.9em; color: var(--warning);">ü™ô ${reward.cost}</div>
                        </div>
                        <div class="reward-item-actions">
                            <button class="btn-small btn-delete" onclick="deleteReward(${reward.id})">üóëÔ∏è</button>
                        </div>
                    </div>
                `).join('');
            }

            // Purchase history
            const allPurchases = [
                ...data.misha.purchaseHistory.map(p => ({ ...p, kid: 'Misha' })),
                ...data.kamia.purchaseHistory.map(p => ({ ...p, kid: 'Kamia' }))
            ].sort((a, b) => new Date(b.date) - new Date(a.date));

            if (allPurchases.length === 0) {
                historyContainer.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">No purchases yet</p>';
            } else {
                historyContainer.innerHTML = allPurchases.map(purchase => {
                    const date = new Date(purchase.date);
                    const dateStr = date.toLocaleDateString() + ' ' + date.toLocaleTimeString();
                    return `
                        <div class="history-item">
                            <div>
                                <strong>${purchase.kid}</strong> bought <strong>${purchase.rewardName}</strong>
                                <div style="font-size: 0.8em; color: var(--text-secondary);">${dateStr}</div>
                            </div>
                            <span style="color: var(--warning);">-${purchase.cost} ü™ô</span>
                        </div>
                    `;
                }).join('');
            }
        }

        function renderAdminStats() {
            const data = getData();
            const statsHTML = `
                <h3>Misha</h3>
                <div class="history-item">
                    <strong>Level:</strong>
                    <span>Level ${data.misha.level} (${LEVEL_TITLES[data.misha.level]})</span>
                </div>
                <div class="history-item">
                    <strong>XP:</strong>
                    <span>${data.misha.xp} / ${getXPForLevel(data.misha.level)}</span>
                </div>
                <div class="history-item">
                    <strong>Coins:</strong>
                    <span>ü™ô ${data.misha.coins}</span>
                </div>
                <div class="history-item">
                    <strong>Crabs:</strong>
                    <span>ü¶Ä ${data.misha.crabs}</span>
                </div>
                <div class="history-item">
                    <strong>Discoveries:</strong>
                    <span>üìö ${data.misha.discoveryHistory.length} facts learned</span>
                </div>
                <div class="history-item">
                    <strong>Streak:</strong>
                    <span>üî• ${data.misha.streak} days</span>
                </div>
                <div class="history-item">
                    <strong>Achievements:</strong>
                    <span>${data.misha.achievements.length} / ${ACHIEVEMENTS.length}</span>
                </div>
                
                <h3 style="margin-top: 30px;">Kamia</h3>
                <div class="history-item">
                    <strong>Level:</strong>
                    <span>Level ${data.kamia.level} (${LEVEL_TITLES[data.kamia.level]})</span>
                </div>
                <div class="history-item">
                    <strong>XP:</strong>
                    <span>${data.kamia.xp} / ${getXPForLevel(data.kamia.level)}</span>
                </div>
                <div class="history-item">
                    <strong>Coins:</strong>
                    <span>ü™ô ${data.kamia.coins}</span>
                </div>
                <div class="history-item">
                    <strong>Crabs:</strong>
                    <span>ü¶Ä ${data.kamia.crabs}</span>
                </div>
                <div class="history-item">
                    <strong>Discoveries:</strong>
                    <span>üìö ${data.kamia.discoveryHistory.length} facts learned</span>
                </div>
                <div class="history-item">
                    <strong>Streak:</strong>
                    <span>üî• ${data.kamia.streak} days</span>
                </div>
                <div class="history-item">
                    <strong>Achievements:</strong>
                    <span>${data.kamia.achievements.length} / ${ACHIEVEMENTS.length}</span>
                </div>
                
                <h3 style="margin-top: 30px;">Weekly Leaderboard üèÜ</h3>
                <div class="history-item" style="font-size: 1.3em; background: linear-gradient(135deg, #FFD700, #FFA500); color: white; border-radius: 10px; padding: 15px;">
                    <strong>${data.misha.xp > data.kamia.xp ? 'Misha' : 'Kamia'} is in the lead!</strong>
                    <span>${Math.max(data.misha.xp, data.kamia.xp)} XP</span>
                </div>
                <div class="history-item">
                    <strong>Misha:</strong>
                    <span>${data.misha.xp} XP</span>
                </div>
                <div class="history-item">
                    <strong>Kamia:</strong>
                    <span>${data.kamia.xp} XP</span>
                </div>
            `;
            document.getElementById('admin-stats').innerHTML = statsHTML;
        }

        // Fun Facts Admin Functions
        function addFunFact() {
            const emoji = document.getElementById('funfact-emoji').value.trim();
            const topic = document.getElementById('funfact-topic').value.trim();
            const simple = document.getElementById('funfact-simple').value.trim();
            const detailed = document.getElementById('funfact-detailed').value.trim();
            const crabs = parseInt(document.getElementById('funfact-crabs').value) || 5;

            if (!emoji || !topic || !simple || !detailed) {
                alert('Please fill in all fields');
                return;
            }

            const data = getData();
            const maxId = Math.max(0, ...data.funFacts.map(f => f.id));
            
            data.funFacts.push({
                id: maxId + 1,
                emoji,
                topic,
                simple,
                detailed,
                crabs
            });
            
            saveData(data);

            // Clear form
            document.getElementById('funfact-emoji').value = '';
            document.getElementById('funfact-topic').value = '';
            document.getElementById('funfact-simple').value = '';
            document.getElementById('funfact-detailed').value = '';
            document.getElementById('funfact-crabs').value = '5';

            renderAdminFunFactList();
        }

        function deleteFunFact(factId) {
            if (!confirm('Delete this fun fact?')) return;

            const data = getData();
            data.funFacts = data.funFacts.filter(f => f.id !== factId);
            saveData(data);
            renderAdminFunFactList();
        }

        function renderAdminFunFactList() {
            const data = getData();
            const container = document.getElementById('admin-funfact-list');
            const countEl = document.getElementById('funfact-count');
            
            if (countEl) {
                countEl.textContent = `(${data.funFacts.length} facts)`;
            }

            if (data.funFacts.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">No fun facts yet</p>';
                return;
            }

            container.innerHTML = data.funFacts.map((fact, index) => `
                <div class="reward-item">
                    <span class="reward-item-emoji">${fact.emoji}</span>
                    <div class="reward-item-info">
                        <strong>${fact.topic}</strong>
                        <div style="font-size: 0.9em; color: var(--text-secondary);">
                            Simple: ${fact.simple.substring(0, 50)}${fact.simple.length > 50 ? '...' : ''}
                        </div>
                        <div style="font-size: 0.9em; color: var(--success);">+${fact.crabs} ü¶Ä</div>
                        <div style="font-size: 0.8em; color: var(--text-secondary);">Day ${(index % data.funFacts.length) + 1} in rotation</div>
                    </div>
                    <div class="reward-item-actions">
                        <button class="btn-small btn-delete" onclick="deleteFunFact(${fact.id})">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');
        }

        function renderAdminView() {
            selectKidAdmin('misha');
            switchTab('tasks');
        }

        // Initialize
        window.onload = function() {
            checkDailyReset();
            const data = getData();
            document.body.setAttribute('data-theme', data.theme);
            document.querySelector('.theme-toggle').textContent = data.theme === 'light' ? 'üåô' : '‚òÄÔ∏è';
            updateLandingStats();
        };
    </script>
    
    <!-- Built by NeoClawLabs ü¶Äü¶â -->
</body>
</html>